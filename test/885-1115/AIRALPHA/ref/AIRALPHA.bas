10 :REM  AIRALPHA.BAS   NAVPROGseven Airport/Facility Sort            29-Dec-81
20 :REM 
30 :REM  Developed by\tAlan Bose  (AOPA 642188)
40 :REM \t\t\tVice President, Taildragger Flyers
50 :REM \t\t\tRoss Field, Benton Harbor, MI
60 :REM 
70 CLEAR 4000:WIDTH 80
80 BL$=CHR$(7):E$=CHR$(27):ER$=E$+"E":P$=E$+"p":Q$=E$+"q":Y$=E$+"Y": \n   L$=E$+"l":X1$=E$+"x1":J$=E$+"j":K$=E$+"k":J1$=E$+"J"
90 DEF FN C$(C1,C2)=Y$+CHR$(C1+31)+CHR$(C2+31)
100 FOR I=8383 TO 8391:D5$=D5$+CHR$(PEEK(I)):NEXT I
110 PRINT X1$;FN C$(25,1);ER$;FN C$(1,1);ER$
120 HD$="A I R P O R T / F A C I L I T Y   S O R T I N G"
130 PRINT FN C$(6,1);P$
140 PRINT TAB(40-LEN(HD$)/2);HD$;TAB(79);Q$
150 PRINT FN C$(10,23);"1  -  Identifier"
160 PRINT FN C$(12,23);"2  -  State/Identifier"
170 PRINT FN C$(14,23);"3  -  State/City"
180 PRINT FN C$(16,23);"4  -  State/Facility/Ident"
190 PRINT FN C$(18,23);"5  -  As filed (no sort)"
200 PRINT FN C$(21,23);"Select sort criteria  <MENU>  ";
210 C$=INPUT$(1):C=VAL(C$)
220 IF C$=CHR$(13) THEN PRINT ER$:LOAD"MENU",R
230 IF C<1 OR C>5 THEN PRINT CHR$(7);:GOTO 210
240 PRINT CHR$(27);"E";"Standby one..."
250 OPEN "R",2,"SY1:AIRPORTS.RND"
260 MD=(LOC(2)*5)
270 DIM ID$(MD+1),ST$(MD+1),REF(MD+1)
280 :REM build indices for ident, city, state, facilities and location on file
290 FOR J=1 TO MD
300 REC=((J-1)MOD5)+1:SS=(J-1) [FC] 5
310 IF [0xFF][AF](2)<>REC THEN GET #2,REC
320 OPTION #2,SS*50 AS DU$,5 AS ID$,2 AS FAC$,4 AS DU$,20 AS A$,2 AS D1$, \n    4 AS M1$,2 AS D$,4 AS M$
330 ID$(J)=ID$
340 IF ASC(ID$)=0 THEN ID$(J)="     "
350 IF ID$(J)="" THEN ID$(J)="     "
360 REF(J)=J-1
370 I2=INSTR(A$,", ")+2
380 IF I2=2 THEN I2=INSTR(A$,",")+1
390 X$=MID$(A$,I2,2)
400 :REM 
410 D6=[0xFF][AA](D1$):M6=CVI(M1$):D5=[0xFF][AA](D$):M5=CVI(M$)
420 M1=M6/60:P2=D6+M1:M=M5/60:P1=D5+M
430 IF J=1 THEN N=P2:SO=P2:E=P1:W=P1
440 IF P2>N THEN N=P2:NI$=ID$:N$=A$
450 IF P2<SO AND P2<>0 THEN SO=P2:SI$=ID$:S$=A$
460 IF P1<E AND P2<>0 THEN E=P1:EI$=ID$:E$=A$
470 IF P1>W THEN W=P1:WI$=ID$:W$=A$
480 :REM 
490 ON C GOTO 530,510,520,500,550
500 ST=163:X$=X$+LEFT$(FAC$,2):GOTO 540
510 ST=227.5:GOTO 540
520 ST=240.5:X$=X$+LEFT$(A$,I2):GOTO 540
530 ST=172:X$=LEFT$(ID$,1)
540 GOSUB 1240:ST$(J)=X$
550 NEXT J
560 IF C=5 THEN 750
570 PRINT ER$;"Sorting should take about";(MD*STMOD60)+1;"minutes."
580 M=MD
590 M=INT(M/2)
600 IF M=0THEN 750
610 J1=1:K1=MD-M
620 I1=J1
630 L1=I1+M
640 IF ST$(I1)+ID$(I1)<ST$(L1)+ID$(L1) THEN 720
650 X$=ST$(I1):ST$(I1)=ST$(L1):ST$(L1)=X$
660 X$=ID$(I1):ID$(I1)=ID$(L1):ID$(L1)=X$
670 X=REF(I1):REF(I1)=REF(L1):REF(L1)=X
680 PRINT "~";
690 I1=I1-M
700 IF I1<1THEN 720
710 GOTO 630
720 J1=J1+1:PRINT" ";
730 IF J1>K1 THEN 590
740 GOTO 620
750 :REM  Printout Airport/Facility Listing
760 PRINT ER$:PRINT"Output:  Enter P for printer, S for screen  ";
770 X$=INPUT$(1):GOSUB1240:PRINT ER$:IF X$="P" THEN LS$="LP:":GOTO 800
780 IF X$="S" THEN LS$="TT:":GOTO 800
790 PRINT BL$:GOTO 760
800 OPEN "O",1,LS$
810 IF X$="S" THEN PRINT ER$;FN C$(25,9); \n    "Hit simultaneously CTRL-S to stop listing, CTRL-Q to resume";FN C$(1,1)
820 PRINT #1,"Sort criteria: ";
830 ON C GOTO 840,850,860,870,880
840 PRINT #1,"Identifier";:GOTO 890
850 PRINT #1,"State/Identifier";:GOTO 890
860 PRINT #1,"State/City";:GOTO 890
870 PRINT #1,"State/Facilities/Identifier";:GOTO 890
880 PRINT #1,"As filed (no sort)";
890 PRINT #1,TAB(65);D5$:PRINT #1,
900 FOR J=1 TO MD
910 IF ID$(J)="     " THEN S=S+1:GOTO 1150
920 REC=(REF(J)MOD5)+1:SS=REF(J) [FC] 5
930 IF LREC<>REC THEN LREC=REC:GET#2,REC
940 OPTION #2,SS*50 AS DU$,5 AS ID$,2 AS FAC$,4 AS FR$,20 AS NM$,2 AS D1$, \n    4 AS M1$,2 AS D$,4 AS M$,4 AS V$,1 AS V1$,2 AS EL$
950 IF C=5 AND J=1 THEN 980
960 IF C=5 OR LEFT$(ST$(J-1),2)=LEFT$(ST$(J),2) THEN 1000
970 PRINT #1,CHR$(10);CHR$(10);TAB(30);"****** ";LEFT$(ST$(J),2); \n    " ******";CHR$(10)
980 IF C=5 THEN PRINT #1,"Ref";
990 PRINT #1,TAB(5);"Ident Fac  Freq";TAB(32);"Name";TAB(47);"Lat"; \n    TAB(56);"Long";TAB(65);"Var";TAB(71);"Elev";CHR$(10)
1000 IF C=5 THEN PRINT #1,J-1; :ELSE PRINT #1,J-S;
1010 PRINT #1,TAB(5);ID$;TAB(11);FAC$;TAB(15);
1020 F5=CVI(FR$):IF F5=0 THEN 1070
1030 IF F5>136 THEN PRINT #1,USING"####";F5;:GOTO 1070
1040 IF F5*10MOD1=F5*10/1 THEN PRINT #1,USING"####.#";F5;:GOTO 1070
1050 IF F5*100MOD1=F5*100/1 THEN PRINT #1,USING"####.##";F5;:GOTO 1070
1060 PRINT #1,USING"###.###";F5;
1070 PRINT #1,TAB(23);NM$;
1080 D6=[0xFF][AA](D1$):PRINT #1,TAB(45);USING"##";D6;
1090 M6=CVI(M1$):PRINT #1,TAB(48);USING"##.#";M6;
1100 D5=[0xFF][AA](D$):PRINT #1,TAB(54);USING"###";D5;
1110 M5=CVI(M$):PRINT #1,TAB(58);USING"##.#";M5;
1120 V5=CVI(V$):PRINT #1,TAB(63);USING"###.#";V5;
1130 PRINT #1,V1$;
1140 E5=[0xFF][AA](EL$):PRINT #1,TAB(69);USING"#####";E5
1150 NEXT J
1160 PRINT #1,:PRINT#1,
1170 PRINT #1,"Farthest North: ";NI$;" ";N$
1180 PRINT #1,"Farthest South: ";SI$;" ";S$
1190 PRINT #1,"Farthest East: ";EI$;" ";E$
1200 PRINT #1,"Farthest West: ";WI$;" ";W$
1210 CLOSE
1220 IF X$="S" THEN PRINT FNC$(25,25);L$; \n     "Hit <RETURN> to continue...";:X$=INPUT$(1)
1230 GOTO 70
1240 :REM map lc
1250 FOR L=1 TO LEN(X$):U$=MID$(X$,L,1)
1260 IF ASC(U$)>96 AND ASC(U$)<123 THEN MID$(X$,L,1)=CHR$(ASC(U$)-32)
1270 NEXT L:RETURN
