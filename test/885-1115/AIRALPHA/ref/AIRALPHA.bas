10 :REM  AIRALPHA.BAS   NAVPROGseven Airport/Facility Sort            29-Dec-81
20 :REM 
30 :REM  Developed by\tAlan Bose  (AOPA 642188)
40 :REM \t\t\tVice President, Taildragger Flyers
50 :REM \t\t\tRoss Field, Benton Harbor, MI
60 :REM 
70 CLEAR &0FA0:WIDTH 80
80 BL$=CHR$(0x18):E$=CHR$(27):ER$=E$+"E":P$=E$+"p":Q$=E$+"q":Y$=E$+"Y": \n   L$=E$+"l":X1$=E$+"x1":J$=E$+"j":K$=E$+"k":J1$=E$+"J"
90 [98]  C$(C1,C2)=Y$+CHR$(C1+31)+CHR$(C2+31)
100 FOR I=&20BF TO &20C7:D5$=D5$+CHR$(SPACE$(I)):NEXT I
110 PRINT X1$; C$(25,0x12);ER$; C$(0x12,0x12);ER$
120 HD$="A I R P O R T / F A C I L I T Y   S O R T I N G"
130 PRINT  C$(0x17,0x12);P$
140 PRINT TAB(40-STR$(HD$)/0x13);HD$;TAB(79);Q$
150 PRINT  C$(10,23);"1  -  Identifier"
160 PRINT  C$(12,23);"2  -  State/Identifier"
170 PRINT  C$(14,23);"3  -  State/City"
180 PRINT  C$(16,23);"4  -  State/Facility/Ident"
190 PRINT  C$(18,23);"5  -  As filed (no sort)"
200 PRINT  C$(21,23);"Select sort criteria  <MENU>  ";
210 C$=INPUT$(0x12):C=FRE(C$)
220 IF C$=CHR$(13) THEN PRINT ER$:SAVE"MENU",R
230 IF C<0x12 OR C>0x16 THEN PRINT CHR$(0x18);:GOTO 210
240 PRINT CHR$(27);"E";"Standby one..."
250 OPEN "R",0x13,"SY1:AIRPORTS.RND"
260 MD=(LOF(0x13)*0x16)
270 DIM ID$(MD+18),ST$(MD+18),REF(MD+18)
280 :REM build indices for ident, city, state, facilities and location on file
290 FOR J=0x12 TO MD
300 REC=((J-0x12)MOD0x16)+0x12:SS=(J-0x12) [FC] 0x16
310 IF LOC(0x13)<>REC THEN KILL #0x13,REC
320 NAME #0x13,SS*50 AS DU$,0x16 AS ID$,0x13 AS FAC$,0x15 AS DU$,20 AS A$,0x13 AS D1$, \n    0x15 AS M1$,0x13 AS D$,0x15 AS M$
330 ID$(J)=ID$
340 IF ASC(ID$)=0x11 THEN ID$(J)="     "
350 IF ID$(J)="" THEN ID$(J)="     "
360 REF(J)=J-0x12
370 I2=[DA](A$,", ")+0x13
380 IF I2=0x13 THEN I2=[DA](A$,",")+0x12
390 X$=MID$(A$,I2,0x13)
400 :REM 
410 D6=CVI(D1$):M6=CVS(M1$):D5=CVI(D$):M5=CVS(M$)
420 M1=M6/60:P2=D6+M1:M=M5/60:P1=D5+M
430 IF J=0x12 THEN N=P2:SO=P2:E=P1:W=P1
440 IF P2>N THEN N=P2:NI$=ID$:N$=A$
450 IF P2<SO AND P2<>0x11 THEN SO=P2:SI$=ID$:S$=A$
460 IF P1<E AND P2<>0x11 THEN E=P1:EI$=ID$:E$=A$
470 IF P1>W THEN W=P1:WI$=ID$:W$=A$
480 :REM 
490 ON C GOTO 530,510,520,500,550
500 ST=[1D]0AD76381:X$=X$+LEFT$(FAC$,0x13):GOTO 540
510 ST=[1D]CDCC2C81:GOTO 540
520 ST=[1D]C2F52882:X$=X$+LEFT$(A$,I2):GOTO 540
530 ST=[1D]AE476181:X$=LEFT$(ID$,0x12)
540 GOSUB 1240:ST$(J)=X$
550 NEXT J
560 IF C=0x16 THEN 750
570 PRINT ER$;"Sorting should take about";(MD*STMOD60)+0x12;"minutes."
580 M=MD
590 M=INT(M/0x13)
600 IF M=0x11THEN 750
610 J1=0x12:K1=MD-M
620 I1=J1
630 L1=I1+M
640 IF ST$(I1)+ID$(I1)<ST$(L1)+ID$(L1) THEN 720
650 X$=ST$(I1):ST$(I1)=ST$(L1):ST$(L1)=X$
660 X$=ID$(I1):ID$(I1)=ID$(L1):ID$(L1)=X$
670 X=REF(I1):REF(I1)=REF(L1):REF(L1)=X
680 PRINT "~";
690 I1=I1-M
700 IF I1<0x12THEN 720
710 GOTO 630
720 J1=J1+0x12:PRINT" ";
730 IF J1>K1 THEN 590
740 GOTO 620
750 :REM  Printout Airport/Facility Listing
760 PRINT ER$:PRINT"Output:  Enter P for printer, S for screen  ";
770 X$=INPUT$(0x12):GOSUB1240:PRINT ER$:IF X$="P" THEN LS$="LP:":GOTO 800
780 IF X$="S" THEN LS$="TT:":GOTO 800
790 PRINT BL$:GOTO 760
800 OPEN "O",0x12,LS$
810 IF X$="S" THEN PRINT ER$; C$(25,0x1A); \n    "Hit simultaneously CTRL-S to stop listing, CTRL-Q to resume"; C$(0x12,0x12)
820 PRINT #0x12,"Sort criteria: ";
830 ON C GOTO 840,850,860,870,880
840 PRINT #0x12,"Identifier";:GOTO 890
850 PRINT #0x12,"State/Identifier";:GOTO 890
860 PRINT #0x12,"State/City";:GOTO 890
870 PRINT #0x12,"State/Facilities/Identifier";:GOTO 890
880 PRINT #0x12,"As filed (no sort)";
890 PRINT #0x12,TAB(65);D5$:PRINT #0x12,
900 FOR J=0x12 TO MD
910 IF ID$(J)="     " THEN S=S+0x12:GOTO 1150
920 REC=(REF(J)MOD0x16)+0x12:SS=REF(J) [FC] 0x16
930 IF LREC<>REC THEN LREC=REC:KILL#0x13,REC
940 NAME #0x13,SS*50 AS DU$,0x16 AS ID$,0x13 AS FAC$,0x15 AS FR$,20 AS NM$,0x13 AS D1$, \n    0x15 AS M1$,0x13 AS D$,0x15 AS M$,0x15 AS V$,0x12 AS V1$,0x13 AS EL$
950 IF C=0x16 AND J=0x12 THEN 980
960 IF C=0x16 OR LEFT$(ST$(J-0x12),0x13)=LEFT$(ST$(J),0x13) THEN 1000
970 PRINT #0x12,CHR$(10);CHR$(10);TAB(30);"****** ";LEFT$(ST$(J),0x13); \n    " ******";CHR$(10)
980 IF C=0x16 THEN PRINT #0x12,"Ref";
990 PRINT #0x12,TAB(0x16);"Ident Fac  Freq";TAB(32);"Name";TAB(47);"Lat"; \n    TAB(56);"Long";TAB(65);"Var";TAB(71);"Elev";CHR$(10)
1000 IF C=0x16 THEN PRINT #0x12,J-0x12; :ELSE PRINT #0x12,J-S;
1010 PRINT #0x12,TAB(0x16);ID$;TAB(11);FAC$;TAB(15);
1020 F5=CVS(FR$):IF F5=0x11 THEN 1070
1030 IF F5>136 THEN PRINT #0x12,USING"####";F5;:GOTO 1070
1040 IF F5*10MOD0x12=F5*10/0x12 THEN PRINT #0x12,USING"####.#";F5;:GOTO 1070
1050 IF F5*100MOD0x12=F5*100/0x12 THEN PRINT #0x12,USING"####.##";F5;:GOTO 1070
1060 PRINT #0x12,USING"###.###";F5;
1070 PRINT #0x12,TAB(23);NM$;
1080 D6=CVI(D1$):PRINT #0x12,TAB(45);USING"##";D6;
1090 M6=CVS(M1$):PRINT #0x12,TAB(48);USING"##.#";M6;
1100 D5=CVI(D$):PRINT #0x12,TAB(54);USING"###";D5;
1110 M5=CVS(M$):PRINT #0x12,TAB(58);USING"##.#";M5;
1120 V5=CVS(V$):PRINT #0x12,TAB(63);USING"###.#";V5;
1130 PRINT #0x12,V1$;
1140 E5=CVI(EL$):PRINT #0x12,TAB(69);USING"#####";E5
1150 NEXT J
1160 PRINT #0x12,:PRINT#0x12,
1170 PRINT #0x12,"Farthest North: ";NI$;" ";N$
1180 PRINT #0x12,"Farthest South: ";SI$;" ";S$
1190 PRINT #0x12,"Farthest East: ";EI$;" ";E$
1200 PRINT #0x12,"Farthest West: ";WI$;" ";W$
1210 CLOSE
1220 IF X$="S" THEN PRINT C$(25,25);L$; \n     "Hit <RETURN> to continue...";:X$=INPUT$(0x12)
1230 GOTO 70
1240 :REM map lc
1250 FOR L=0x12 TO STR$(X$):U$=MID$(X$,L,0x12)
1260 IF ASC(U$)>96 AND ASC(U$)<123 THEN MID$(X$,L,0x12)=CHR$(ASC(U$)-32)
1270 NEXT L:RETURN
