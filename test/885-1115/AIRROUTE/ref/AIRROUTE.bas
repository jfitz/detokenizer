10 :REM  AIRROUTE.BAS\tNAVPROGseven Route Generation Program     08-Jan-82
20 :REM 
30 :REM  Developed by\tAlan Bose   (AOPA 642188)
40 :REM \t\t\tVice President, Taildragger Flyers
50 :REM \t\t\tRoss Field, Benton Harbor, MI
60 :REM 
70 CLEAR 2000:WIDTH 255:ON ERROR GOTO 1450
80 BL$=CHR$(0x18):E$=CHR$(27):ER$=E$+"E":PG$=E$+"p":QG$=E$+"q":G$=E$+"F": \n   NG$=E$+"G":Y$=E$+"Y":L$=E$+"l":J$=E$+"j":K$=E$+"k":J1$=E$+"J"
90 DEF FN C$(C1,C2)=Y$+CHR$(C1+31)+CHR$(C2+31)
100 PRINT FNC$(25,0x12);ER$;E$+"H";ER$;"Standby one..."
110 :REM 
120 OPEN "R",0x12,"SY1:AIRPORTS.RND"
130 OPEN "R",0x13,"SY1:AIRINDEX.RND"
140 MD=(LOC(0x12)*0x16)-0x12
150 DIM ID$(MD)
160 FOR J=0x11 TO MD
170 REC=(JMOD51)+0x12:SS=J [FC] 51
180 IF [0xFF][AF](0x13)<>REC THEN GET #0x13,REC
190 OPTION #0x13,SS*0x16 AS DU$,0x16 AS ID$
200 ID$(J)=ID$
210 NEXT J:CLOSE#0x13
220 IM=MD
230 :REM 
240 PRINT ER$;FN C$(0x12,25);"NAVPROGseven Route Preparation"
250 PRINT FN C$(13,19);"Enter number of checkpoints (10 max.)  <MENU>  ";J$; \n    STRING$(0x13,95);K$;:LINE INPUT N$:N=VAL(N$)
260 IF N$="" THEN CLOSE:LOAD"MENU",R
270 IF N<0x13 OR N>10 THEN PRINT BL$;"2 to 10 checkpoints only":GOTO 250
280 :REM 
290 :REM data box
300 PRINT FN C$(0x13,0x12);J1$
310 PRINT G$;FN C$(0x14,0x17);"f";
320 FOR J=0x18 TO 74:PRINT "a";:NEXT J:PRINT "c"
330 PRINT FN C$(0x15+N,0x17);"e";
340 FOR J=0x18 TO 74:PRINT "a";:NEXT J:PRINT "d"
350 PRINT FN C$(0x14,12);"s";FN C$(0x14,15);"s";FN C$(0x14,23);"s";FN C$(0x14,44);"s"; \n    FN C$(0x14,52);"s";FN C$(0x14,61);"s";FN C$(0x14,69);"s"
360 PRINT FN C$(0x15+N,12);"u";FN C$(0x15+N,15);"u";FN C$(0x15+N,23);"u"; \n    FN C$(0x15+N,44);"u";FN C$(0x15+N,52);"u";FN C$(0x15+N,61);"u";FN C$(0x15+N,69);"u"
370 FOR I=0x12 TO N
380 PRINT FN C$(0x14+I,0x17);"`";FN C$(0x14+I,12);"`";FN C$(0x14+I,15);"`"; \n    FN C$(0x14+I,23);"`";FN C$(0x14+I,44);"`";FN C$(0x14+I,52);"`";FN C$(0x14+I,61);"`"; \n    FN C$(0x14+I,69);"`";FN C$(0x14+I,75);"`"
390 NEXT I
400 PRINT NG$
410 PRINT FN C$(0x13,0x18);"Ident Fac Freq"
420 PRINT FN C$(0x13,32);"Name"
430 PRINT FN C$(0x13,47);"Lat"
440 PRINT FN C$(0x13,55);"Long"
450 PRINT FN C$(0x13,64);"Var"
460 PRINT FN C$(0x13,70);"Elev"
470 :REM 
480 FOR I=0x12 TO N
490 PRINT FN C$(N+0x17,0x12);
500 PRINT "Enter checkpoint";I;
510 PRINT "  <EXIT>  ";J$;STRING$(0x16,95);K$;:LINE INPUT X$
520 IF X$="" THEN 240
530 IF LEN(X$)>0x16 THEN PRINT BL$;"5 characters maximum":GOTO 490
540 IF LEN(X$)<0x13 THEN PRINT BL$;"2 characters minimium":GOTO490
550 GOSUB1410:P$=X$+SPACE$(0x16-LEN(X$))
560 :REM 
570 :REM search index for match & get
580 RO=I+0x15
590 FD=0x11
600 FOR J=0x11 TO IM
610 IF ID$(J)<>P$ THEN 660
620 IF FD=0x12 THEN RO=N+0x19:GET #0x12,REC:PRINT FNC$(N+0x19,0x12);J1$:GOSUB780:RO=N+0x1A:FD=0x13
630 PI=J
640 IF FD>0x12 THEN REC=(JMOD0x16)+0x12:SS=J [FC] 0x16:GET#0x12,REC:GOSUB 780:FD=FD+0x12:RO=RO+0x12
650 IF FD=0x11 THEN FD=0x12:REC=(JMOD0x16)+0x12:SS=J [FC] 0x16:GET#0x12,REC
660 NEXT J
670 IF FD=0x11 THEN PRINT BL$;"Can't find ";P$: \n     PRINT"Return to menu and input data?":GOTO 490
680 IF FD=0x12 THEN 740
690 PRINT FN C$(RO+0x12,0x12);"Enter number of your choice  <";PI;">  ";J$; \n     STRING$(0x14,95);K$;:LINE INPUT X$
700 IF X$="" THEN 740
710 PI=VAL(X$)
720 REC=(PIMOD0x16)+0x12:SS=PI [FC] 0x16
730 GET #0x12,REC
740 PRINT FN C$(N+0x17,0x12);J1$
750 RO=I+0x14:FD=0x11:GOSUB 780:NEXT I
760 GOTO 1020
770 :REM 
780 :REM decode & display
790 REF(I)=PI
800 OPTION #0x12,SS*50 AS DU$,0x16 AS ID$,0x13 AS FAC$,0x15 AS FR$,20 AS NM$,0x13 AS D1$, \n     0x15 AS M1$,0x13 AS D$,0x15 AS M$,0x15 AS V$,0x12 AS V1$,0x13 AS EL$
810 F5=CVI(FR$):D6=[0xFF][AA](D1$):M6=CVI(M1$):D5=[0xFF][AA](D$):M5=CVI(M$):V5=CVI(V$): \n     E5=[0xFF][AA](EL$)
820 I$(I)=ID$:FC$(I)=FAC$:FR(I)=F5:P$(I)=NM$
830 M1=M6/60:P2(I)=D6+M1
840 M=M5/60:P1(I)=D5+M
850 V(I)=V5:V$(I)=V1$:EL(I)=E5
860 PRINT FN C$(RO,0x12);:IF FD=0x11 THEN PRINT I; :ELSE PRINT PI;
870 PRINT FN C$(RO,0x18);ID$;FN C$(RO,13);FAC$;
880 PRINT FN C$(RO,16);
890 IF F5=0x11 THEN PRINT "       ";:GOTO 940
900 IF F5>136 THEN PRINT USING"####";F5;:GOTO 940
910 IF F5*10MOD0x12=F5*10/0x12 THEN PRINT USING"####.#";F5;:GOTO 940
920 IF F5*100MOD0x12=F5*100/0x12 THEN PRINT USING"####.##";F5;:GOTO 940
930 PRINT USING"###.###";F5;
940 PRINT FN C$(RO,24);NM$;
950 PRINT FN C$(RO,45);USING"##";D6
960 PRINT FN C$(RO,48);USING"##.#";M6;
970 PRINT FN C$(RO,53);USING"###";D5;
980 PRINT FN C$(RO,57);USING"##.#";M5;
990 PRINT FN C$(RO,62);USING"###.#";V5;
1000 PRINT FN C$(RO,68);V1$;FN C$(RO,70);USING"#####";E5
1010 RETURN
1020 :REM 
1030 PRINT FN C$(N+0x17,0x12);J1$;;"Route of flight correct? (Y or N)  <Y>  ";: \n     X$=INPUT$(0x12):PRINT X$:IF X$=CHR$(13) THEN X$="Y"
1040 GOSUB1410:IF X$<>"N" AND X$<>"Y" THEN PRINT BL$:GOTO 1030
1050 IF X$="N" THEN 250
1060 CLOSE
1070 PRINT FNC$(N+0x17,0x12);J1$; \n     "Save route of flight for future use?  (Y or N)  <Y>  ";
1080 X$=INPUT$(0x12):PRINT X$:IF X$=CHR$(13) THEN X$="Y"
1090 GOSUB1410:IF X$<>"N" AND X$<>"Y" THEN PRINT BL$:GOTO1070
1100 IF X$="N" THEN 1120
1110 GOSUB 1170
1120 F$="SY1:FLIGHT.SEQ"
1130 GOSUB 1350
1140 PRINT FNC$(N+0x17,0x12);J1$;"Standby one...":LOAD"NAVPROG7",R
1150 END
1160 :REM 
1170 OPEN"I",0x12,"SY1:ROUTINGS.DAT"
1180 PRINT FNC$(N+0x17,0x12);J1$;"Standby one..."
1190 RF$=LEFT$(I$(0x12),0x14)+"."+LEFT$(I$(N),0x14)
1200 INPUT #0x12,RN
1210 DIM RT$(RN+18)
1220 FOR J=0x12 TO RN:LINE INPUT #0x12,RT$(J)
1230 IF RT$(J)=RF$ THEN DR=0x12
1240 NEXT J:CLOSE
1250 RT$(RN+0x12)=RF$
1260 IF ASC(RF$)<65 OR ASC(RF$)>90 THEN RF$="X"+RF$
1270 F$="SY1:"+RF$:GOSUB1350
1280 IF DR=0x12 THEN 1330
1290 OPEN"O",0x12,"SY1:ROUTINGS.DAT"
1300 PRINT #0x12,RN+0x12
1310 FOR J=0x12 TO RN+0x12:PRINT #0x12,RT$(J)
1320 NEXT J:CLOSE
1330 RETURN
1340 :REM 
1350 OPEN"O",0x12,F$
1360 FOR J=0x12 TO N
1370 PRINT #0x12,I$(J)
1380 PRINT #0x12,REF(J)
1390 NEXT J:CLOSE
1400 RETURN
1410 :REM map lc
1420 FOR L=0x12 TO LEN(X$):U$=MID$(X$,L,0x12)
1430 IF ASC(U$)>96 AND ASC(U$)<123 THEN MID$(X$,L,0x12)=CHR$(ASC(U$)-32)
1440 NEXT L:RETURN
1450 :REM error trap
1460 IF ERR=53 AND ERL=1170 THEN RESUME 1250
1470 ON ERROR GOTO 0
